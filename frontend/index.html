<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reddit Insight Analyzer</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üîç Reddit Insight Analyzer</h1>
            <p class="subtitle">Extract evidence-based insights from Reddit discussions</p>
            <div class="header-actions">
                <select id="recentSearches" class="recent-searches-dropdown" style="display: none;" onchange="loadRecentSearch(this.value)">
                    <option value="">Recent Searches</option>
                </select>
            </div>
        </header>

        <main>
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn" onclick="switchTab('url')">
                    üîó Analyze URL
                </button>
                <button class="tab-btn active" onclick="switchTab('topic')">
                    üîç Topic Search
                </button>
                <button class="tab-btn" onclick="switchTab('subreddit')">
                    üìä Subreddit Analysis
                </button>
            </div>

            <!-- Tab 1: URL Analysis -->
            <div id="urlTab" class="tab-content" style="display: none;">
                <div class="input-section">
                    <h2>Analyze Single Reddit Post</h2>
                    <div class="input-group">
                        <input
                            type="text"
                            id="redditUrl"
                            placeholder="Paste Reddit post URL here..."
                            class="url-input"
                        />
                    </div>
                    <p class="hint">Example: https://www.reddit.com/r/AskReddit/comments/...</p>

                    <!-- Role & Goal Section for URL Tab -->
                    <div class="role-goal-section" style="margin-top: 15px;">
                        <div class="role-input-group">
                            <label for="urlUserRole" class="context-label">
                                üë§ Your Role
                            </label>
                            <input
                                type="text"
                                id="urlUserRole"
                                placeholder="e.g., Product Manager, Marketer, Founder"
                                class="url-input"
                            />
                        </div>
                        <div class="goal-input-group">
                            <label for="urlUserGoal" class="context-label">
                                üéØ Your Goal
                            </label>
                            <input
                                type="text"
                                id="urlUserGoal"
                                placeholder="e.g., find pain points, validate idea, generate content angles"
                                class="url-input"
                            />
                        </div>
                    </div>

                    <button id="analyzeBtn" class="analyze-btn" onclick="handleAnalyzeUrl()" style="margin-top: 15px;">
                        <span class="btn-text">Analyze</span>
                        <span class="btn-loader" style="display: none;">
                            <span class="spinner"></span>
                        </span>
                    </button>
                </div>
            </div>

            <!-- Tab 2: Topic Search -->
            <div id="topicTab" class="tab-content active">
                <div class="input-section">
                    <h2>Search Reddit by Topic</h2>

                    <!-- Research Question (REQUIRED) -->
                    <div class="research-context-section">
                        <label for="researchQuestion" class="context-label">
                            üí° What are you researching? <span class="required-tag">*</span>
                        </label>
                        <textarea
                            id="researchQuestion"
                            placeholder="e.g., budget weight training shoes, notion vs evernote, best crm for startups"
                            class="research-input"
                            rows="2"
                            required
                        ></textarea>
                        <p class="hint">Use keywords for best results (e.g., "weight training shoes budget" not full sentences)</p>
                    </div>

                    <!-- Role & Goal Section -->
                    <div class="role-goal-section">
                        <div class="role-input-group">
                            <label for="userRole" class="context-label">
                                üë§ Your Role
                            </label>
                            <input
                                type="text"
                                id="userRole"
                                placeholder="e.g., Product Manager, Marketer, Founder, Content Creator"
                                class="url-input"
                            />
                            <p class="hint">What's your role? This tailors insights to your decision-making needs</p>
                        </div>

                        <div class="goal-input-group">
                            <label for="userGoal" class="context-label">
                                üéØ Your Goal
                            </label>
                            <input
                                type="text"
                                id="userGoal"
                                placeholder="e.g., find pain points, validate idea, improve positioning, generate content angles"
                                class="url-input"
                            />
                            <p class="hint">What do you want to learn? This focuses the analysis on actionable outcomes</p>
                        </div>
                    </div>

                    <!-- Search Method Selection -->
                    <div class="search-method-section">
                        <label class="method-label">
                            üîç How do you want to find posts?
                        </label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="searchMethod" value="reddit" checked onchange="toggleSearchMethod()">
                                <span class="radio-label">Search across Reddit</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="searchMethod" value="subreddits" onchange="toggleSearchMethod()">
                                <span class="radio-label">Search specific subreddits only</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="searchMethod" value="urls" onchange="toggleSearchMethod()">
                                <span class="radio-label">I have specific URLs to analyze</span>
                            </label>
                        </div>

                        <!-- Subreddit Input (shown when subreddits radio selected) -->
                        <div id="subredditMethodInput" style="display: none; margin-top: 15px;">
                            <input
                                type="text"
                                id="topicSubreddits"
                                placeholder="e.g., AskReddit, productivity, Notion"
                                class="url-input"
                            />
                            <p class="hint">Comma-separated list of subreddits</p>
                        </div>

                        <!-- URL Input (shown when URLs radio selected) -->
                        <div id="urlMethodInput" style="display: none; margin-top: 15px;">
                            <textarea
                                id="topicUrls"
                                placeholder="Paste Reddit post URLs here (one per line)..."
                                class="url-textarea"
                                rows="4"
                            ></textarea>
                            <p class="hint">Enter one or more Reddit post URLs, separated by new lines</p>
                        </div>
                    </div>

                    <!-- Search Filters -->
                    <div class="search-form">
                        <div class="filter-row">
                            <div class="filter-group">
                                <label>Time Range:</label>
                                <select id="topicTimeRange" class="select-input">
                                    <option value="day">Past 24 Hours</option>
                                    <option value="week" selected>Past Week</option>
                                    <option value="month">Past Month</option>
                                    <option value="year">Past Year</option>
                                    <option value="all">All Time</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Max Results:</label>
                                <select id="topicLimit" class="select-input">
                                    <option value="10">10 posts</option>
                                    <option value="15" selected>15 posts</option>
                                    <option value="25">25 posts</option>
                                    <option value="50">50 posts</option>
                                </select>
                            </div>
                        </div>
                        <button class="analyze-btn" onclick="handleSearchByTopic()">
                            üîç Search & Analyze
                        </button>
                    </div>
                </div>

                <!-- Topic Search Results -->
                <div id="topicResults" style="display: none;">
                    <div class="results-header">
                        <h3 id="topicResultsTitle">Search Results</h3>
                        <div id="topicResultsSummary"></div>
                    </div>
                    <div id="topicSelectedActions" style="display: none;">
                        <div class="selected-summary">
                            <span id="topicSelectedCount">0 posts selected</span>
                            <button class="analyze-btn" onclick="analyzeTopicSelectedPosts()">
                                üìä Analyze Selected Posts
                            </button>
                        </div>
                    </div>
                    <div id="topicPostsList"></div>
                    <div id="topicSelectedActionsBottom" style="display: none;">
                        <div class="selected-summary">
                            <span id="topicSelectedCountBottom">0 posts selected</span>
                            <button class="analyze-btn" onclick="analyzeTopicSelectedPosts()">
                                üìä Analyze Selected Posts
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 3: Subreddit Analysis -->
            <div id="subredditTab" class="tab-content" style="display: none;">
                <div class="input-section">
                    <h2>Analyze Subreddit Top Posts</h2>
                    <div class="search-form">
                        <div class="input-group">
                            <input
                                type="text"
                                id="subredditName"
                                placeholder="Enter subreddit name (without r/)..."
                                class="url-input"
                            />
                        </div>

                        <!-- Role & Goal Section for Subreddit Tab -->
                        <div class="role-goal-section">
                            <div class="role-input-group">
                                <label for="subredditUserRole" class="context-label">
                                    üë§ Your Role
                                </label>
                                <input
                                    type="text"
                                    id="subredditUserRole"
                                    placeholder="e.g., Product Manager, Marketer, Founder"
                                    class="url-input"
                                />
                            </div>
                            <div class="goal-input-group">
                                <label for="subredditUserGoal" class="context-label">
                                    üéØ Your Goal
                                </label>
                                <input
                                    type="text"
                                    id="subredditUserGoal"
                                    placeholder="e.g., find pain points, validate idea, generate content angles"
                                    class="url-input"
                                />
                            </div>
                        </div>

                        <div class="filter-row">
                            <div class="filter-group">
                                <label>Time Range:</label>
                                <select id="subredditTimeRange" class="select-input">
                                    <option value="day">Past 24 Hours</option>
                                    <option value="week" selected>Past Week</option>
                                    <option value="month">Past Month</option>
                                    <option value="year">Past Year</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Max Results:</label>
                                <select id="subredditLimit" class="select-input">
                                    <option value="10">10 posts</option>
                                    <option value="15" selected>15 posts</option>
                                    <option value="25">25 posts</option>
                                    <option value="50">50 posts</option>
                                </select>
                            </div>
                        </div>
                        <button class="analyze-btn" onclick="handleSearchSubreddit()">
                            üìä Get Top Posts
                        </button>
                    </div>
                </div>

                <!-- Subreddit Search Results -->
                <div id="subredditResults" style="display: none;">
                    <div class="results-header">
                        <h3 id="subredditResultsTitle">Top Posts</h3>
                        <div id="subredditResultsSummary"></div>
                    </div>
                    <div id="subredditSelectedActions" style="display: none;">
                        <div class="selected-summary">
                            <span id="subredditSelectedCount">0 posts selected</span>
                            <button class="analyze-btn" onclick="analyzeSubredditSelectedPosts()">
                                üìä Analyze Selected Posts
                            </button>
                        </div>
                    </div>
                    <div id="subredditPostsList"></div>
                    <div id="subredditSelectedActionsBottom" style="display: none;">
                        <div class="selected-summary">
                            <span id="subredditSelectedCountBottom">0 posts selected</span>
                            <button class="analyze-btn" onclick="analyzeSubredditSelectedPosts()">
                                üìä Analyze Selected Posts
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Section -->
            <section id="statusSection" class="status-section" style="display: none;">
                <div class="status-card">
                    <div class="status-icon">‚è≥</div>
                    <div class="status-text" id="statusText">Initializing...</div>
                    <div class="status-progress">
                        <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                    </div>
                </div>
            </section>

            <!-- Results Section -->
            <section id="resultsSection" class="results-section" style="display: none;">
                <!-- Extracted Data -->
                <div id="extractedDataCard" class="result-card" style="display: none;">
                    <div class="card-header">
                        <h2>üìä Extracted Comments</h2>
                        <div style="display: flex; gap: 10px;">
                            <button class="export-btn" onclick="exportToPDF()" style="background: #ed8936;">üìÑ Export PDF</button>
                            <button class="export-btn" onclick="copyToClipboard()" style="background: #9f7aea;">üìã Copy for AI</button>
                            <button class="export-btn" onclick="copyAsText()" style="background: #48bb78;">üìù Copy Text</button>
                            <button class="export-btn" onclick="exportData()">üíæ Export JSON</button>
                        </div>
                    </div>
                    <div id="extractedDataContent"></div>
                </div>

                <!-- AI Insights -->
                <div id="insightsCard" class="result-card" style="display: none;">
                    <div class="card-header">
                        <h2>ü§ñ AI-Powered Insights</h2>
                        <button class="export-btn" onclick="exportInsightsPDF()">üìÑ Export PDF</button>
                    </div>
                    <div id="insightsContent"></div>
                </div>

                <!-- Multi-Post Results -->
                <div id="multiPostResults" style="display: none;"></div>
            </section>

            <!-- Error Section -->
            <section id="errorSection" class="error-section" style="display: none;">
                <div class="error-card">
                    <div class="error-icon">‚ö†Ô∏è</div>
                    <div class="error-title">Analysis Failed</div>
                    <div class="error-message" id="errorMessage"></div>
                    <button class="retry-btn" onclick="location.reload()">Try Again</button>
                </div>
            </section>
        </main>

        <footer>
            <p>Powered by Gemini AI ‚Ä¢ Node.js Backend ‚Ä¢ <a href="https://github.com/codewithjaidesai/reddit-analysis" target="_blank">GitHub</a></p>
        </footer>
    </div>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
