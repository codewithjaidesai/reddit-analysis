<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Voice of the Customer</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Voice of the Customer</h1>
            <p class="subtitle">Extract evidence-based insights from real online communities</p>
            <div class="header-actions">
                <select id="recentSearches" class="recent-searches-dropdown" style="display: none;" onchange="loadRecentSearch(this.value)">
                    <option value="">Recent Searches</option>
                </select>
                <select id="savedContent" class="recent-searches-dropdown" style="display: none;" onchange="loadSavedContent(this.value)">
                    <option value="">Saved Content</option>
                </select>
            </div>
        </header>

        <main>
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn" onclick="switchTab('url')">
                    Analyze URL
                </button>
                <button class="tab-btn active" onclick="switchTab('topic')">
                    Topic Search
                </button>
                <button class="tab-btn" onclick="switchTab('subreddit')">
                    Subreddit Analysis
                </button>
            </div>

            <!-- Tab 1: URL Analysis -->
            <div id="urlTab" class="tab-content" style="display: none;">
                <div class="input-section">
                    <h2>Analyze Single Reddit Post</h2>
                    <div class="input-group">
                        <input
                            type="text"
                            id="redditUrl"
                            placeholder="Paste Reddit post URL here..."
                            class="url-input"
                        />
                    </div>
                    <p class="hint">Example: https://www.reddit.com/r/AskReddit/comments/...</p>

                    <!-- Research Goal Section -->
                    <div class="research-goal-section">
                        <h3 class="section-label">Research Goal</h3>

                        <div class="persona-outcome-container">
                            <!-- Persona Selection -->
                            <div class="persona-selection">
                                <label class="selection-label">SELECT PERSONA</label>
                                <div class="persona-cards" id="urlPersonaCards">
                                    <div class="persona-card" data-persona="product_manager" onclick="selectPersona('url', 'product_manager')">
                                        <span class="persona-icon">PM</span>
                                        <div class="persona-info">
                                            <span class="persona-name">Product Manager</span>
                                            <span class="persona-desc">Find market gaps & validate features</span>
                                        </div>
                                    </div>
                                    <div class="persona-card" data-persona="marketer" onclick="selectPersona('url', 'marketer')">
                                        <span class="persona-icon">MK</span>
                                        <div class="persona-info">
                                            <span class="persona-name">Marketer / Copywriter</span>
                                            <span class="persona-desc">Find hooks & customer language</span>
                                        </div>
                                    </div>
                                    <div class="persona-card" data-persona="content_creator" onclick="selectPersona('url', 'content_creator')">
                                        <span class="persona-icon">CC</span>
                                        <div class="persona-info">
                                            <span class="persona-name">Content Creator</span>
                                            <span class="persona-desc">Find video ideas & trending topics</span>
                                        </div>
                                    </div>
                                    <div class="persona-card" data-persona="custom" onclick="selectPersona('url', 'custom')">
                                        <span class="persona-icon">+</span>
                                        <div class="persona-info">
                                            <span class="persona-name">Custom / Other</span>
                                            <span class="persona-desc">Define your own research parameters</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Outcome Selection -->
                            <div class="outcome-selection" id="urlOutcomeSelection" style="display: none;">
                                <label class="selection-label" id="urlOutcomeLabel">SELECT SPECIFIC OUTCOME</label>
                                <div class="outcome-options" id="urlOutcomeOptions">
                                    <!-- Options populated by JS based on persona -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Hidden fields to store role/goal values -->
                    <input type="hidden" id="urlUserRole" />
                    <input type="hidden" id="urlUserGoal" />

                    <button id="analyzeBtn" class="analyze-btn start-research-btn" onclick="handleAnalyzeUrl()">
                        <span class="btn-text">Start Research →</span>
                        <span class="btn-loader" style="display: none;">
                            <span class="spinner"></span>
                        </span>
                    </button>
                </div>
            </div>

            <!-- Tab 2: Topic Search -->
            <div id="topicTab" class="tab-content active">
                <!-- Collapsible Input Section -->
                <div id="topicInputSection" class="collapsible-section">
                    <!-- Collapsed Summary (shown when collapsed) -->
                    <div class="collapsed-summary" onclick="toggleSection('topicInputSection')">
                        <div class="collapsed-summary-content">
                            <div class="collapsed-summary-icon">Q</div>
                            <div class="collapsed-summary-text">
                                <div class="collapsed-summary-title" id="topicInputCollapsedTitle">Search Parameters</div>
                                <div class="collapsed-summary-subtitle" id="topicInputCollapsedSubtitle">Click to edit search</div>
                            </div>
                        </div>
                        <div class="collapsed-summary-expand">
                            Edit <span class="expand-arrow">▼</span>
                        </div>
                    </div>

                    <!-- Collapsible Content -->
                    <div class="collapsible-content">
                        <div class="input-section">
                            <h2>Search Reddit by Topic</h2>

                            <!-- Research Question (REQUIRED) -->
                            <div class="research-context-section">
                                <label for="researchQuestion" class="context-label">
                                    What are you researching? <span class="required-tag">*</span>
                                </label>
                                <textarea
                                    id="researchQuestion"
                                    placeholder="e.g., budget weight training shoes, notion vs evernote, best crm for startups"
                                    class="research-input"
                                    rows="2"
                                    required
                                ></textarea>
                                <p class="hint">Use keywords for best results (e.g., "weight training shoes budget" not full sentences)</p>
                            </div>

                            <!-- Research Goal Section (PROMINENT - right after research input) -->
                            <div class="research-goal-section">
                                <h3 class="section-label">Research Goal</h3>

                                <div class="persona-outcome-container">
                                    <!-- Persona Selection -->
                                    <div class="persona-selection">
                                        <label class="selection-label">SELECT PERSONA</label>
                                        <div class="persona-cards" id="topicPersonaCards">
                                            <div class="persona-card" data-persona="product_manager" onclick="selectPersona('topic', 'product_manager')">
                                                <span class="persona-icon">PM</span>
                                                <div class="persona-info">
                                                    <span class="persona-name">Product Manager</span>
                                                    <span class="persona-desc">Find market gaps & validate features</span>
                                                </div>
                                            </div>
                                            <div class="persona-card" data-persona="marketer" onclick="selectPersona('topic', 'marketer')">
                                                <span class="persona-icon">MK</span>
                                                <div class="persona-info">
                                                    <span class="persona-name">Marketer / Copywriter</span>
                                                    <span class="persona-desc">Find hooks & customer language</span>
                                                </div>
                                            </div>
                                            <div class="persona-card" data-persona="content_creator" onclick="selectPersona('topic', 'content_creator')">
                                                <span class="persona-icon">CC</span>
                                                <div class="persona-info">
                                                    <span class="persona-name">Content Creator</span>
                                                    <span class="persona-desc">Find video ideas & trending topics</span>
                                                </div>
                                            </div>
                                            <div class="persona-card" data-persona="custom" onclick="selectPersona('topic', 'custom')">
                                                <span class="persona-icon">+</span>
                                                <div class="persona-info">
                                                    <span class="persona-name">Custom / Other</span>
                                                    <span class="persona-desc">Define your own research parameters</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Outcome Selection -->
                                    <div class="outcome-selection" id="topicOutcomeSelection" style="display: none;">
                                        <label class="selection-label" id="topicOutcomeLabel">SELECT SPECIFIC OUTCOME</label>
                                        <div class="outcome-options" id="topicOutcomeOptions">
                                            <!-- Options populated by JS based on persona -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Hidden fields to store role/goal values -->
                            <input type="hidden" id="userRole" />
                            <input type="hidden" id="userGoal" />

                            <!-- Advanced Options (subtle, at the bottom) -->
                            <div class="advanced-options">
                                <div class="advanced-options-row">
                                    <div class="option-group">
                                        <label>Search in</label>
                                        <select id="searchMethodDropdown" class="subtle-select" onchange="toggleSearchMethodDropdown()">
                                            <option value="reddit" selected>All of Reddit</option>
                                            <option value="subreddits">Specific subreddits</option>
                                            <option value="urls">Specific URLs</option>
                                        </select>
                                    </div>
                                    <div class="option-group">
                                        <label>Time</label>
                                        <select id="topicTimeRange" class="subtle-select">
                                            <option value="day">24 hours</option>
                                            <option value="week">Week</option>
                                            <option value="month">Month</option>
                                            <option value="year" selected>Year</option>
                                            <option value="all">All time</option>
                                        </select>
                                    </div>
                                    <div class="option-group">
                                        <label>Posts to Analyze</label>
                                        <select id="topicLimit" class="subtle-select">
                                            <option value="10">10</option>
                                            <option value="15">15</option>
                                            <option value="25" selected>25</option>
                                            <option value="50">50</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- Subreddit Input (shown when subreddits selected) -->
                                <div id="subredditMethodInput" class="conditional-input" style="display: none;">
                                    <input
                                        type="text"
                                        id="topicSubreddits"
                                        placeholder="Enter subreddits (comma-separated): AskReddit, productivity, Notion"
                                        class="subtle-text-input"
                                    />
                                </div>

                                <!-- URL Input (shown when URLs selected) -->
                                <div id="urlMethodInput" class="conditional-input" style="display: none;">
                                    <textarea
                                        id="topicUrls"
                                        placeholder="Paste Reddit post URLs (one per line)..."
                                        class="subtle-textarea"
                                        rows="3"
                                    ></textarea>
                                </div>
                            </div>

                            <button class="analyze-btn start-research-btn" onclick="handleSearchByTopic()">
                                Start Research →
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Collapsible Results Section (hidden until search) -->
                <div id="topicResultsSection" class="collapsible-section" style="display: none;">
                    <!-- Collapsed Summary (shown when collapsed) -->
                    <div class="collapsed-summary" onclick="toggleSection('topicResultsSection')">
                        <div class="collapsed-summary-content">
                            <div class="collapsed-summary-icon">R</div>
                            <div class="collapsed-summary-text">
                                <div class="collapsed-summary-title" id="topicResultsCollapsedTitle">Search Results</div>
                                <div class="collapsed-summary-subtitle" id="topicResultsCollapsedSubtitle">Click to view/edit selection</div>
                            </div>
                        </div>
                        <div class="collapsed-summary-expand">
                            Edit <span class="expand-arrow">▼</span>
                        </div>
                    </div>

                    <!-- Collapsible Content -->
                    <div class="collapsible-content">
                        <!-- Topic Search Results -->
                        <div id="topicResults" style="display: none;">
                            <div class="results-header">
                                <h3 id="topicResultsTitle">Search Results</h3>
                                <div id="topicResultsSummary"></div>
                            </div>
                            <div id="topicSelectedActions" style="display: none;">
                                <div class="selected-summary">
                                    <span id="topicSelectedCount">0 posts selected</span>
                                    <button class="analyze-btn" onclick="analyzeTopicSelectedPosts()">
                                        Analyze Selected →
                                    </button>
                                </div>
                            </div>
                            <div id="topicPostsList"></div>
                            <div id="topicSelectedActionsBottom" style="display: none;">
                                <div class="selected-summary">
                                    <span id="topicSelectedCountBottom">0 posts selected</span>
                                    <button class="analyze-btn" onclick="analyzeTopicSelectedPosts()">
                                        Analyze Selected →
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tab 3: Subreddit Analysis -->
            <div id="subredditTab" class="tab-content" style="display: none;">
                <div class="input-section">
                    <h2>Analyze Subreddit Top Posts</h2>
                    <div class="input-group">
                        <label for="subredditName" class="context-label">
                            Which subreddit?
                        </label>
                        <input
                            type="text"
                            id="subredditName"
                            placeholder="e.g., productivity, startups, fitness"
                            class="research-input"
                            style="font-size: 1rem;"
                        />
                        <p class="hint">Enter subreddit name without r/</p>
                    </div>

                    <!-- Research Goal Section (PROMINENT) -->
                    <div class="research-goal-section">
                        <h3 class="section-label">Research Goal</h3>

                        <div class="persona-outcome-container">
                            <!-- Persona Selection -->
                            <div class="persona-selection">
                                <label class="selection-label">SELECT PERSONA</label>
                                <div class="persona-cards" id="subredditPersonaCards">
                                    <div class="persona-card" data-persona="product_manager" onclick="selectPersona('subreddit', 'product_manager')">
                                        <span class="persona-icon">PM</span>
                                        <div class="persona-info">
                                            <span class="persona-name">Product Manager</span>
                                            <span class="persona-desc">Find market gaps & validate features</span>
                                        </div>
                                    </div>
                                    <div class="persona-card" data-persona="marketer" onclick="selectPersona('subreddit', 'marketer')">
                                        <span class="persona-icon">MK</span>
                                        <div class="persona-info">
                                            <span class="persona-name">Marketer / Copywriter</span>
                                            <span class="persona-desc">Find hooks & customer language</span>
                                        </div>
                                    </div>
                                    <div class="persona-card" data-persona="content_creator" onclick="selectPersona('subreddit', 'content_creator')">
                                        <span class="persona-icon">CC</span>
                                        <div class="persona-info">
                                            <span class="persona-name">Content Creator</span>
                                            <span class="persona-desc">Find video ideas & trending topics</span>
                                        </div>
                                    </div>
                                    <div class="persona-card" data-persona="custom" onclick="selectPersona('subreddit', 'custom')">
                                        <span class="persona-icon">+</span>
                                        <div class="persona-info">
                                            <span class="persona-name">Custom / Other</span>
                                            <span class="persona-desc">Define your own research parameters</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Outcome Selection -->
                            <div class="outcome-selection" id="subredditOutcomeSelection" style="display: none;">
                                <label class="selection-label" id="subredditOutcomeLabel">SELECT SPECIFIC OUTCOME</label>
                                <div class="outcome-options" id="subredditOutcomeOptions">
                                    <!-- Options populated by JS based on persona -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Hidden fields to store role/goal values -->
                    <input type="hidden" id="subredditUserRole" />
                    <input type="hidden" id="subredditUserGoal" />

                    <!-- Advanced Options (subtle) -->
                    <div class="advanced-options">
                        <div class="advanced-options-row">
                            <div class="option-group">
                                <label>Time</label>
                                <select id="subredditTimeRange" class="subtle-select">
                                    <option value="day">24 hours</option>
                                    <option value="week">Week</option>
                                    <option value="month">Month</option>
                                    <option value="year" selected>Year</option>
                                </select>
                            </div>
                            <div class="option-group">
                                <label>Results</label>
                                <select id="subredditLimit" class="subtle-select">
                                    <option value="10">10</option>
                                    <option value="15" selected>15</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <button class="analyze-btn start-research-btn" onclick="handleSearchSubreddit()">
                        Start Research →
                    </button>
                </div>

                <!-- Subreddit Search Results -->
                <div id="subredditResults" style="display: none;">
                    <div class="results-header">
                        <h3 id="subredditResultsTitle">Top Posts</h3>
                        <div id="subredditResultsSummary"></div>
                    </div>
                    <div id="subredditSelectedActions" style="display: none;">
                        <div class="selected-summary">
                            <span id="subredditSelectedCount">0 posts selected</span>
                            <button class="analyze-btn" onclick="analyzeSubredditSelectedPosts()">
                                Analyze Selected →
                            </button>
                        </div>
                    </div>
                    <div id="subredditPostsList"></div>
                    <div id="subredditSelectedActionsBottom" style="display: none;">
                        <div class="selected-summary">
                            <span id="subredditSelectedCountBottom">0 posts selected</span>
                            <button class="analyze-btn" onclick="analyzeSubredditSelectedPosts()">
                                Analyze Selected →
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Section -->
            <section id="statusSection" class="status-section" style="display: none;">
                <div class="status-card">
                    <div class="status-icon">⏳</div>
                    <div class="status-text" id="statusText">Initializing...</div>
                    <div class="status-progress">
                        <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                    </div>
                </div>
            </section>

            <!-- Results Section -->
            <section id="resultsSection" class="results-section" style="display: none;">
                <!-- Extracted Data -->
                <div id="extractedDataCard" class="result-card" style="display: none;">
                    <div class="card-header">
                        <h2>Extracted Comments</h2>
                        <div style="display: flex; gap: 10px;">
                            <button class="export-btn" onclick="exportToPDF()" style="background: #ed8936;">Export PDF</button>
                            <button class="export-btn" onclick="copyToClipboard()" style="background: #9f7aea;">Copy for AI</button>
                            <button class="export-btn" onclick="copyAsText()" style="background: #48bb78;">Copy Text</button>
                            <button class="export-btn" onclick="exportData()">Export JSON</button>
                        </div>
                    </div>
                    <div id="extractedDataContent"></div>
                </div>

                <!-- AI Insights -->
                <div id="insightsCard" class="result-card" style="display: none;">
                    <div class="card-header">
                        <h2>AI-Powered Insights</h2>
                        <button class="export-btn" onclick="exportInsightsPDF()">Export PDF</button>
                    </div>
                    <div id="insightsContent"></div>
                </div>

                <!-- Multi-Post Results -->
                <div id="multiPostResults" style="display: none;"></div>
            </section>

            <!-- Error Section -->
            <section id="errorSection" class="error-section" style="display: none;">
                <div class="error-card">
                    <div class="error-icon">⚠️</div>
                    <div class="error-title">Analysis Failed</div>
                    <div class="error-message" id="errorMessage"></div>
                    <button class="retry-btn" onclick="location.reload()">Try Again</button>
                </div>
            </section>
        </main>

    </div>

    <!-- Re-analyze Modal -->
    <div id="reanalyzeModal" class="reanalyze-modal" onclick="closeReanalyzeModal(event)">
        <div class="reanalyze-modal-content" onclick="event.stopPropagation()">
            <div class="reanalyze-modal-header">
                <h3 class="reanalyze-modal-title">Re-analyze with Different Goal</h3>
                <button class="reanalyze-modal-close" onclick="closeReanalyzeModal()">&times;</button>
            </div>
            <div class="reanalyze-modal-body">
                <p style="color: var(--text-secondary); margin-bottom: 20px; font-size: 0.9rem;">
                    Use the same Reddit data but get insights from a different perspective.
                </p>

                <div class="reanalyze-modal-section">
                    <div class="reanalyze-modal-section-title">Select Persona</div>
                    <div class="persona-cards" id="reanalyzePersonaCards">
                        <div class="persona-card" data-persona="product_manager" onclick="selectReanalyzePersona('product_manager')">
                            <span class="persona-icon">PM</span>
                            <div class="persona-info">
                                <span class="persona-name">Product Manager</span>
                                <span class="persona-desc">Find market gaps & validate features</span>
                            </div>
                        </div>
                        <div class="persona-card" data-persona="marketer" onclick="selectReanalyzePersona('marketer')">
                            <span class="persona-icon">MK</span>
                            <div class="persona-info">
                                <span class="persona-name">Marketer / Copywriter</span>
                                <span class="persona-desc">Find hooks & customer language</span>
                            </div>
                        </div>
                        <div class="persona-card" data-persona="content_creator" onclick="selectReanalyzePersona('content_creator')">
                            <span class="persona-icon">CC</span>
                            <div class="persona-info">
                                <span class="persona-name">Content Creator</span>
                                <span class="persona-desc">Find video ideas & trending topics</span>
                            </div>
                        </div>
                        <div class="persona-card" data-persona="custom" onclick="selectReanalyzePersona('custom')">
                            <span class="persona-icon">+</span>
                            <div class="persona-info">
                                <span class="persona-name">Custom / Other</span>
                                <span class="persona-desc">Define your own research parameters</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="reanalyze-modal-section" id="reanalyzeOutcomeSection" style="display: none;">
                    <div class="reanalyze-modal-section-title" id="reanalyzeOutcomeLabel">Select Outcome</div>
                    <div class="outcome-options" id="reanalyzeOutcomeOptions">
                        <!-- Options populated by JS -->
                    </div>
                </div>
            </div>
            <div class="reanalyze-modal-footer">
                <button class="reanalyze-modal-btn secondary" onclick="closeReanalyzeModal()">Cancel</button>
                <button class="reanalyze-modal-btn primary" id="reanalyzeSubmitBtn" onclick="submitReanalyze()" disabled>
                    Re-analyze
                </button>
            </div>
        </div>
    </div>

    <!-- Generate Content Modal -->
    <div id="generateModal" class="generate-modal" onclick="closeGenerateModal(event)">
        <div class="generate-modal-content" onclick="event.stopPropagation()">
            <div class="generate-modal-header">
                <h3 id="generateModalTitle" class="generate-modal-title">Generate Content</h3>
                <button class="generate-modal-close" onclick="closeGenerateModal()">&times;</button>
            </div>
            <div class="generate-modal-body">
                <p id="generateModalDescription" class="generate-modal-desc"></p>

                <div class="generate-form-group">
                    <label for="generateFocusInput">Focus (optional)</label>
                    <input type="text" id="generateFocusInput" placeholder="e.g., weight loss transformation stories" class="generate-input">
                    <span class="generate-input-hint">Narrow down the content focus</span>
                </div>

                <div class="generate-form-group">
                    <label>Tone</label>
                    <div class="generate-radio-group">
                        <label class="generate-radio">
                            <input type="radio" name="generateTone" value="professional">
                            <span>Professional</span>
                        </label>
                        <label class="generate-radio">
                            <input type="radio" name="generateTone" value="conversational" checked>
                            <span>Conversational</span>
                        </label>
                        <label class="generate-radio">
                            <input type="radio" name="generateTone" value="casual">
                            <span>Casual</span>
                        </label>
                    </div>
                </div>

                <div class="generate-form-group">
                    <label>Length</label>
                    <div class="generate-radio-group">
                        <label class="generate-radio">
                            <input type="radio" name="generateLength" value="short">
                            <span>Short</span>
                        </label>
                        <label class="generate-radio">
                            <input type="radio" name="generateLength" value="medium" checked>
                            <span>Medium</span>
                        </label>
                        <label class="generate-radio">
                            <input type="radio" name="generateLength" value="long">
                            <span>Long</span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="generate-modal-footer">
                <button class="generate-modal-btn secondary" onclick="closeGenerateModal()">Cancel</button>
                <button class="generate-modal-btn primary" onclick="submitGenerate()">
                    Generate
                </button>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
    <!-- Vercel Web Analytics -->
    <script>
      window.va = window.va || function () { (window.vaq = window.vaq || []).push(arguments); };
    </script>
    <script defer src="/_vercel/insights/script.js"></script>
</body>
</html>
